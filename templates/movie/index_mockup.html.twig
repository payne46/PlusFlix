<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}PlusFlix - main{% endblock %}</title>

    {% block stylesheets %}
        <link rel="stylesheet" href="{{ asset('css/movie-main.css') }}">
        <link rel="stylesheet" href="{{ asset('css/banner.css') }}">
    {% endblock %}

</head>
<body>
    <header>
         {% include 'movie/banner.html.twig' %}
    </header>

    <main>
        <div class="search-section">
            <input type="search" >
            <button class="search-button">SZUKAJ</button>
        </div>

        <div class="selection-section">
            <div class="categories">
                <div class="normal-buttons">
                    <button class="normal-button">KOMEDIA</button>
                    <button class="normal-button">DRAMAT</button>
                    <button class="normal-button">HORROR</button>
                    <button class="normal-button">SCI-FI</button>
                    <button class="normal-button">AKCJA</button>
                    <button class="normal-button">THRILLER</button>
                    <button class="normal-button last-button">PRZYGODOWY</button>
                </div>

                <div class="small-buttons">
                    <div class="custom-select-wrapper categories-mobile" id="categories-select-wrapper">
                        <div class="custom-select" id="categories-select">
                            Kategoria
                            <img src="{{ asset('images/keyboard_arrow_down.svg') }}">
                        </div>
                        <div class="custom-options">
                          <div data-value="comedy">KOMEDIA</div>
                          <div data-value="drama">DRAMAT</div>
                          <div data-value="horror">HORROR</div>
                          <div data-value="sci-fi">SCI-FI</div>
                          <div data-value="action">AKCJA</div>
                          <div data-value="thriller">THRILLER</div>
                          <div data-value="adventure">PRZYGODOWY</div>
                        </div>
                    </div>


                    <button class="special-button" id="favourite-button">
                        <img src="{{ asset('images/favorite.svg') }}" alt="favourite movies button">
                    </button>
                    <button class="special-button" id="clear-button">
                        <img src="{{ asset('images/mop.svg') }}" alt="clear options button">
                    </button>
                </div>
            </div>

            <!-- sort -->
            <div class="custom-select-wrapper" id="sort-select-wrapper">
                <div id="sort-select" class="custom-select">
                    Sortowanie
                    <img src="{{ asset('images/keyboard_arrow_down.svg') }}">
                </div>
                <div class="custom-options">
                  <div data-value="rating">PO OCENIE</div>
                </div>
            </div>
        </div>

        <div class="movies-container">
            {% for movie in movies %}
                    <div class="movie-container">
                        <a href="{{ path('movie_show', { id: movie.id }) }}">
                            <div class="movie-banner"
                                style="background: {{ movie.banner }}"></div>
                            <div class="movie-info">
                                <p class="movie-title">{{ movie.title }}
                                     <span class="movie-rating">({{ movie.rating }})</span>
                                </p>
                            </div>
                        </a>
                    </div>
            {% endfor %}
        </div>

    </main>

    <script>
        const sortSelectWrapper = document.getElementById('sort-select-wrapper');
        const sortSelectBox = document.getElementById('sort-select');

        const categoriesSelectWrapper = document.getElementById('categories-select-wrapper');
        const categoriesSelectBox = document.getElementById('categories-select');

        const options = document.querySelectorAll('.custom-options div');

        const categoriesButtons = document.querySelectorAll('.normal-button, .small-button');
        const mopButton = document.getElementById('clear-button');
        const favouriteButton = document.getElementById('favourite-button');

        categoriesButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.classList.contains('selected')) {
                    btn.classList.remove('selected');
                } else {
                    btn.classList.add('selected');
                }
            });
        });

        mopButton.addEventListener('click', () => {
            categoriesButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            sortSelectBox.innerHTML = `
                Sortowanie
                <img src="{{ asset('images/keyboard_arrow_down.svg') }}">
            `;
            categoriesSelectBox.innerHTML = `
                Kategorie
                <img src="{{ asset('images/keyboard_arrow_down.svg') }}">
            `;

        });
      
        sortSelectBox.addEventListener('click', () => {
          sortSelectWrapper.classList.toggle('open');
        });

        categoriesSelectBox.addEventListener('click', () => {
            categoriesSelectWrapper.classList.toggle('open');
        });
      
        options.forEach(option => {
          option.addEventListener('click', () => {
            const wrapper = option.parentElement.parentElement;
            const selectBox = wrapper.querySelectorAll('.custom-select')[0];
            selectBox.textContent = option.textContent;
            selectBox.innerHTML = `
                ${option.textContent}
                <img src="{{ asset('images/keyboard_arrow_down.svg') }}">
            `;
            wrapper.classList.remove('open');
          });
        });
      
        // Close dropdown if clicked outside
        document.addEventListener('click', (e) => {
          if (!sortSelectWrapper.contains(e.target)) {
            sortSelectWrapper.classList.remove('open');
          }
          if (!categoriesSelectWrapper.contains(e.target)) {
            categoriesSelectWrapper.classList.remove('open');
          }
        });
    </script>

</body>
</html>